<div>
  <h1 style="margin: 0 0 8px 0;">{{ analysis.get("analysis_object", "") }}</h1>
  <div class="muted">
    <span><strong>Datum:</strong> {{ analysis.get("date", "") }}</span> ·
    <span><strong>Owner:</strong> {{ analysis.get("owner", "") }}</span> ·
    <span><strong>Version:</strong> {{ analysis.get("version", "") }}</span>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <h3 style="margin-top: 0;">Scope</h3>
        <p style="white-space: pre-wrap; margin: 0;">{{ analysis.get("scope", "") }}</p>
      </div>
      <div>
        <h3 style="margin-top: 0;">Sammanfattning</h3>
        {% set scenarios = analysis.get("scenarios", []) %}
        <div class="kv">
          <div>Antal scenarion</div>
          <div><code class="badge">{{ scenarios | length }}</code></div>
          <div>Mycket hög:</div>
          <div><code class="badge">{{ analysis.get("summary", {}).get("critical", "") }}</code></div>
          <div>Hög:</div>
          <div><code class="badge">{{ analysis.get("summary", {}).get("high", "") }}</code></div>
          <div>Medel:</div>
          <div><code class="badge">{{ analysis.get("summary", {}).get("middle", "") }}</code></div>
          <div>Låg:</div>
          <div><code class="badge">{{ analysis.get("summary", {}).get("low", "") }}</code></div>
          <div>Mycket Låg:</div>
          <div><code class="badge">{{ analysis.get("summary", {}).get("very_low", "") }}</code></div>
        </div>
      </div>
    </div>
  </div>

  <h2>Scenarion</h2>

  {% for s in analysis.get("scenarios", []) %}
    {% set risk = s.get("risk", {}) %}
    {% set discrete = risk.get("discrete_risk") %}

    <div class="card">
      <h3 style="margin-top: 0;">{{ s.get("name","") }}</h3>
      <p style="white-space: pre-wrap;"><strong>Risk: {{ discrete.get("risk_text","").split(",")[0] }}</strong></p>
      <p style="white-space: pre-wrap;">{{ s.get("description","") }}</p>
      <details style="margin-top: 10px;">
        <h4>Risk</h4>
        <div class="kv">
          <div>Sannolikhet</div><div>{{ discrete.get("probability","") }} ({{ discrete.get("probability_text","") }})</div>
          <div>Konsekvens</div><div>{{ discrete.get("consequence","") }} ({{ discrete.get("consequence_text","") }})</div>
          <div>Risk</div><div><strong>{{ discrete.get("risk","") }} ({{ discrete.get("risk_text","") }})</strong></div>
          <div>Budget: </div><div>{{ risk.get("budget","") }} {{ risk.get("currency","") }}/år</div>
        </div>
        <details>
          <summary>Frågor</summary>
          <h5>Threat Event Frequency</h5>
          {% for q in s.get("questionaires", {}).get("tef", {}).get("questions", []) %}
            <details style="margin-top: 10px;">
              <summary>{{ q.get("text", "") }}</summary>
              <div class="kv" style="margin-top: 8px;">
                <div><strong>Answer</strong></div><div>{{ q.get("answer", "").get("text", "") }}</div>
                <div><strong>Weight</strong></div><div>{{ q.get("answer", "").get("weight", "") }}</div>
              </div>
            </details>
          {% endfor %}
          <h5>Vulnerability</h5>
          {% for q in s.get("questionaires", {}).get("vuln", {}).get("questions", []) %}
            <details style="margin-top: 10px;">
              <summary>{{ q.get("text", "") }}</summary>
              <div class="kv" style="margin-top: 8px;">
                <div><strong>Answer</strong></div><div>{{ q.get("answer", "").get("text", "") }}</div>
                <div><strong>Weight</strong></div><div>{{ q.get("answer", "").get("weight", "") }}</div>
              </div>
            </details>
          {% endfor %}
          <h5>Loss Magnitude</h5>
          {% for q in s.get("questionaires", {}).get("lm", {}).get("questions", []) %}
            <details style="margin-top: 10px;">
              <summary>{{ q.get("text", "") }}</summary>
              <div class="kv" style="margin-top: 8px;">
                <div><strong>Answer</strong></div><div>{{ q.get("answer", "").get("text", "") }}</div>
                <div><strong>Weight</strong></div><div>{{ q.get("answer", "").get("weight", "") }}</div>
              </div>
            </details>
          {% endfor %}
        </details>
      </details>
    </div>
  {% else %}
    <p class="muted">Denna analys saknar scenarion.</p>
  {% endfor %}
</div>
